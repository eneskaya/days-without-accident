<!doctype html>
<html>
    <head>

        <title>days-without-accident</title>
        <link rel="stylesheet/less" type="text/css" href="/public/less/index.less" />
        <!-- <link rel="stylesheet/less" type="text/css" href="/public/css/flipclock.css" /> -->
        <script src="/public/js/less.min.js"></script>
        <!-- <script src="/public/js/flipclock.min.js"></script> -->

    </head>
    <body>


        <div id="timediff"><p></p></div>

        <!-- <div id="flipclock"></div> -->

        <!-- <button id="trigger-custom-accident">DAMN!!</button> -->

        <script src="/socket.io/socket.io.js"></script>
        <script src="/public/js/jquery-1.11.1.min.js"></script>
        <script src="/public/js/moment.min.js"></script>

        <script>
            var socket = io(),
                lastAccidentInterval = undefined;
            // var clock = $('#flipclock').FlipClock({
            //         // ... your options here
            //     });

            socket.on('new-accident-found', function( data ) {
                newAccident( new Date(data.timestamp*1000) );
            });

            // $('trigger-custom-accident').on('click', function () {
            //     socket.emit( 'trigger-custom-accident' );
            // });



            function newAccident( date ) {

                if ( lastAccidentInterval ) {
                    clearInterval( lastAccidentInterval );
                }

                lastAccidentInterval = setInterval( function() {
                    dateNow = new Date();

                    seconds = Math.floor((dateNow - (date))/1000);
                    minutes = Math.floor(seconds/60);
                    hours = Math.floor(minutes/60);
                    days = Math.floor(hours/24);

                    hours = hours-(days*24);
                    minutes = minutes-(days*24*60)-(hours*60);
                    seconds = seconds-(days*24*60*60)-(hours*60*60)-(minutes*60);

                    $('#timediff p').text( days + ' days ' + hours + ' hours ' + minutes + ' minutes ' + seconds + ' seconds ' );
                }, 500 );
            }

        </script>

    </body>
</html>
